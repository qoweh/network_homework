# ë„¤íŠ¸ì›Œí¬ ì±„íŒ… í”„ë¡œê·¸ë¨ - ìƒì„¸ ë¬¸ì„œ

> ì´ ë¬¸ì„œëŠ” OSI 7ê³„ì¸µ ê¸°ë°˜ ë„¤íŠ¸ì›Œí¬ ì±„íŒ…/íŒŒì¼ ì „ì†¡ í”„ë¡œê·¸ë¨ì˜ ì „ì²´ êµ¬ì¡°ì™€ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“š ëª©ì°¨

1. [í”„ë¡œê·¸ë¨ ê°œìš”](#1-í”„ë¡œê·¸ë¨-ê°œìš”)
2. [OSI ê³„ì¸µ êµ¬ì¡°](#2-osi-ê³„ì¸µ-êµ¬ì¡°)
3. [ê° ê³„ì¸µë³„ ìƒì„¸ ì„¤ëª…](#3-ê°-ê³„ì¸µë³„-ìƒì„¸-ì„¤ëª…)
4. [ìƒˆë¡œìš´ ê¸°ëŠ¥ 3ê°€ì§€ ìƒì„¸](#4-ìƒˆë¡œìš´-ê¸°ëŠ¥-3ê°€ì§€-ìƒì„¸)
5. [íŒ¨í‚· êµ¬ì¡° ë¶„ì„](#5-íŒ¨í‚·-êµ¬ì¡°-ë¶„ì„)
6. [ë°ì´í„° íë¦„ ì¶”ì ](#6-ë°ì´í„°-íë¦„-ì¶”ì )
7. [í•µì‹¬ ì•Œê³ ë¦¬ì¦˜](#7-í•µì‹¬-ì•Œê³ ë¦¬ì¦˜)
8. [GUI êµ¬ì„±](#8-gui-êµ¬ì„±)
9. [í…ŒìŠ¤íŠ¸ ì½”ë“œ ì„¤ëª…](#9-í…ŒìŠ¤íŠ¸-ì½”ë“œ-ì„¤ëª…)
10. [ì‹¤í–‰ í™˜ê²½ ë° ì˜ì¡´ì„±](#10-ì‹¤í–‰-í™˜ê²½-ë°-ì˜ì¡´ì„±)

---

## 1. í”„ë¡œê·¸ë¨ ê°œìš”

### 1.1 í”„ë¡œê·¸ë¨ ëª©ì 
ì´ í”„ë¡œê·¸ë¨ì€ **OSI 7ê³„ì¸µ í”„ë¡œí† ì½œ ìŠ¤íƒì„ ì§ì ‘ êµ¬í˜„**í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ê¸° ìœ„í•œ êµìœ¡ìš© í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

- **ì†Œì¼“ APIë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ** ì§ì ‘ ì´ë”ë„· í”„ë ˆì„ì„ ìƒì„±/íŒŒì‹±
- **jNetPcap** ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë§í¬ ê³„ì¸µ(L2)ì—ì„œ ì§ì ‘ íŒ¨í‚· ì†¡ìˆ˜ì‹ 
- IP, ARP, Ethernet í”„ë¡œí† ì½œì„ ì‹¤ì œ RFCì— ê·¼ì ‘í•˜ê²Œ êµ¬í˜„

### 1.2 ì£¼ìš” ê¸°ëŠ¥
| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ | UTF-8 ì¸ì½”ë”©, Fragmentation ì§€ì› |
| íŒŒì¼ ì „ì†¡ | ëŒ€ìš©ëŸ‰ íŒŒì¼ ë¶„í•  ì „ì†¡ ë° ì¬ì¡°ë¦½ |
| ARP í”„ë¡œí† ì½œ | IPâ†’MAC ì£¼ì†Œ ë³€í™˜, ARP ìºì‹œ ê´€ë¦¬ |
| ì•”í˜¸í™” í†µì‹  | XOR ì•”í˜¸í™”ë¡œ ë„ì²­ ë°©ì§€ |
| ìš°ì„ ìˆœìœ„ í | ê¸´ê¸‰ ë©”ì‹œì§€ ìš°ì„  ì²˜ë¦¬ |
| íƒ€ì„ìŠ¤íƒ¬í”„ ë¡œê¹… | ì „ì†¡ ì‹œê°„, ì§€ì—°ì‹œê°„ ì¸¡ì • |

### 1.3 ê¸°ìˆ  ìŠ¤íƒ
- **ì–¸ì–´**: Java 21 (--enable-preview í•„ìš”)
- **ë¹Œë“œ**: Maven 3.x
- **íŒ¨í‚· ìº¡ì²˜**: jNetPcap 2.3.1 (JDK21 wrapper)
- **GUI**: Java Swing
- **í…ŒìŠ¤íŠ¸**: JUnit 5

---

## 2. OSI ê³„ì¸µ êµ¬ì¡°

### 2.1 ì „ì²´ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NetworkChatApp.java (GUI)                        â”‚
â”‚                    ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ (Swing)                     â”‚
â”‚   - ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜ ì„ íƒ    - IP/MAC ì£¼ì†Œ ì„¤ì •                     â”‚
â”‚   - ë©”ì‹œì§€ ì…ë ¥/ì „ì†¡      - íŒŒì¼ ì „ì†¡                            â”‚
â”‚   - ì•”í˜¸í™” On/Off         - ìš°ì„ ìˆœìœ„ ì„ íƒ                        â”‚
â”‚   - ARP ìºì‹œ í…Œì´ë¸”       - ì§€ì—°ì‹œê°„ í‘œì‹œ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ChatAppLayer.java   â”‚       â”‚   FileAppLayer.java   â”‚
â”‚   ì±„íŒ… ì‘ìš© ê³„ì¸µ (L7)  â”‚       â”‚   íŒŒì¼ ì‘ìš© ê³„ì¸µ (L7)  â”‚
â”‚                       â”‚       â”‚                       â”‚
â”‚ â€¢ UTF-8 ì¸ì½”ë”©/ë””ì½”ë”©  â”‚       â”‚ â€¢ íŒŒì¼ ë¶„í• /ì¬ì¡°ë¦½     â”‚
â”‚ â€¢ Fragmentation       â”‚       â”‚ â€¢ ì§„í–‰ë¥  ì½œë°±         â”‚
â”‚ â€¢ XOR ì•”í˜¸í™”          â”‚       â”‚ â€¢ Thread ê¸°ë°˜ ì „ì†¡    â”‚
â”‚ â€¢ ìš°ì„ ìˆœìœ„ í         â”‚       â”‚                       â”‚
â”‚ â€¢ íƒ€ì„ìŠ¤íƒ¬í”„ ë¡œê¹…     â”‚       â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Protocol ë²ˆí˜¸ë¡œ êµ¬ë¶„
                            â”‚ (253=Chat, 254=File)
                            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚        IPLayer.java           â”‚
            â”‚     ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ (L3)         â”‚
            â”‚                               â”‚
            â”‚ â€¢ IP í—¤ë” ìƒì„± (20ë°”ì´íŠ¸)      â”‚
            â”‚ â€¢ TOS í•„ë“œë¡œ ìš°ì„ ìˆœìœ„ ì „ë‹¬     â”‚
            â”‚ â€¢ í”„ë¡œí† ì½œ ì—­ë‹¤ì¤‘í™”            â”‚
            â”‚ â€¢ ARP ì—°ë™ (IPâ†’MAC ë³€í™˜)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                               â”‚
            â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EthernetLayer.java   â”‚       â”‚    ARPLayer.java      â”‚
â”‚  ì´ë”ë„· ê³„ì¸µ (L2)      â”‚       â”‚    ARP ê³„ì¸µ (L2)       â”‚
â”‚                       â”‚       â”‚                       â”‚
â”‚ â€¢ ì´ë”ë„· í”„ë ˆì„ ìƒì„±   â”‚       â”‚ â€¢ ARP Request/Reply   â”‚
â”‚ â€¢ MAC ì£¼ì†Œ í•„í„°ë§      â”‚       â”‚ â€¢ ARP ìºì‹œ ê´€ë¦¬       â”‚
â”‚ â€¢ EtherType ì—­ë‹¤ì¤‘í™”   â”‚       â”‚ â€¢ Proxy ARP           â”‚
â”‚   (0x0800=IP,         â”‚       â”‚ â€¢ Gratuitous ARP      â”‚
â”‚    0x0806=ARP)        â”‚       â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      PhysicalLayer.java       â”‚
            â”‚       ë¬¼ë¦¬ ê³„ì¸µ (L1)           â”‚
            â”‚                               â”‚
            â”‚ â€¢ jNetPcap ì—°ë™               â”‚
            â”‚ â€¢ NICì—ì„œ ì§ì ‘ íŒ¨í‚· ì†¡ìˆ˜ì‹      â”‚
            â”‚ â€¢ ë°±ê·¸ë¼ìš´ë“œ ìˆ˜ì‹  ìŠ¤ë ˆë“œ       â”‚
            â”‚ â€¢ dispatch ë£¨í”„               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    [ ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ (NIC) ]
```

### 2.2 ê³„ì¸µ ê°„ ì¸í„°í˜ì´ìŠ¤ (BaseLayer)

ëª¨ë“  ê³„ì¸µì€ `BaseLayer` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤:

```java
public interface BaseLayer {
    // ê³„ì¸µ ì´ë¦„ ë°˜í™˜
    String GetLayerName();
    
    // í•˜ìœ„/ìƒìœ„ ê³„ì¸µ ì—°ê²°
    BaseLayer GetUnderLayer();
    BaseLayer GetUpperLayer(int index);
    void SetUnderLayer(BaseLayer lowerLayer);
    void SetUpperLayer(BaseLayer upperLayer);
    
    // ë°ì´í„° ì†¡ìˆ˜ì‹ 
    boolean Send(byte[] data, int length);  // í•˜ìœ„ë¡œ ì „ë‹¬
    boolean Receive(byte[] data);           // ìƒìœ„ë¡œ ì „ë‹¬
}
```

### 2.3 ê³„ì¸µ ì—°ê²° (Layer Binding)

`NetworkChatApp.java`ì—ì„œ ê³„ì¸µì„ ì—°ê²°í•©ë‹ˆë‹¤:

```java
// ê³„ì¸µ ê°ì²´ ìƒì„±
chatLayer = new ChatAppLayer(message -> updateUI(message));
fileLayer = new FileAppLayer();
ipLayer = new IPLayer();
arpLayer = new ARPLayer();
ethernetLayer = new EthernetLayer();
physicalLayer = new PhysicalLayer();

// ìƒìœ„â†’í•˜ìœ„ ì—°ê²°
chatLayer.SetUnderLayer(ipLayer);
fileLayer.SetUnderLayer(ipLayer);
ipLayer.SetUnderLayer(ethernetLayer);
ipLayer.setArpLayer(arpLayer);
ethernetLayer.SetUnderLayer(physicalLayer);
arpLayer.SetUnderLayer(ethernetLayer);

// í•˜ìœ„â†’ìƒìœ„ ì—°ê²° (ì—­ë‹¤ì¤‘í™”ìš©)
physicalLayer.SetUpperLayer(ethernetLayer);
ethernetLayer.SetUpperLayer(ipLayer);
ethernetLayer.SetUpperLayer(arpLayer);  // EtherTypeìœ¼ë¡œ êµ¬ë¶„
ipLayer.SetUpperLayer(chatLayer);
ipLayer.SetUpperLayer(fileLayer);        // Protocol ë²ˆí˜¸ë¡œ êµ¬ë¶„
```

---

## 3. ê° ê³„ì¸µë³„ ìƒì„¸ ì„¤ëª…

### 3.1 PhysicalLayer (ë¬¼ë¦¬ ê³„ì¸µ, L1)

**íŒŒì¼**: `PhysicalLayer.java` (234 lines)

**ì—­í• **:
- ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ(NIC)ì™€ ì§ì ‘ í†µì‹ 
- jNetPcapì„ í†µí•´ ë§í¬ ê³„ì¸µ(L2)ì—ì„œ íŒ¨í‚· ìº¡ì²˜/ì „ì†¡

**í•µì‹¬ ë©”ì„œë“œ**:

```java
// ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜ ì—´ê¸°
public boolean open(PcapIf device, boolean promiscuous, long timeoutMillis)

// íŒ¨í‚· ì „ì†¡ (Ethernet í”„ë ˆì„ â†’ NIC)
public boolean Send(byte[] input, int length) {
    pcap.sendPacket(ByteBuffer.wrap(input, 0, length));
}

// ë°±ê·¸ë¼ìš´ë“œ ìˆ˜ì‹  ë£¨í”„ (Runnable êµ¬í˜„)
public void run() {
    while (!Thread.interrupted()) {
        pcap.dispatch(1, handler, this);  // 1ê°œì”© ì²˜ë¦¬
    }
}
```

**ì£¼ìš” ì„¤ì •**:
| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|---------|-----|------|
| snaplen | 2048 | íŒ¨í‚· ìµœëŒ€ ìº¡ì²˜ í¬ê¸° |
| promiscuous | false | ìì‹  ì•ìœ¼ë¡œ ì˜¨ íŒ¨í‚·ë§Œ ìº¡ì²˜ |
| timeout | 200ms | ë‚®ì€ ì§€ì—° ì‹œê°„ ìœ ì§€ |

---

### 3.2 EthernetLayer (ë°ì´í„°ë§í¬ ê³„ì¸µ, L2)

**íŒŒì¼**: `EthernetLayer.java` (259 lines)

**ì—­í• **:
- Ethernet í”„ë ˆì„ ìƒì„± ë° íŒŒì‹±
- MAC ì£¼ì†Œ ê¸°ë°˜ í•„í„°ë§
- EtherTypeì— ë”°ë¥¸ ì—­ë‹¤ì¤‘í™” (IP ë˜ëŠ” ARP)

**ì´ë”ë„· í”„ë ˆì„ êµ¬ì¡°**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ ëª©ì ì§€ MAC   â”‚ ì¶œë°œì§€ MAC   â”‚ EtherTypeâ”‚   í˜ì´ë¡œë“œ  â”‚ FCS  â”‚
â”‚   (6ë°”ì´íŠ¸)  â”‚   (6ë°”ì´íŠ¸)  â”‚(2ë°”ì´íŠ¸) â”‚ (ê°€ë³€ ê¸¸ì´) â”‚(4B)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
        6             6            2        46~1500       4
                                   â”‚
                      0x0800 = IPv4, 0x0806 = ARP
```

**í•µì‹¬ ë¡œì§ - Send**:
```java
public boolean Send(byte[] input, int length) {
    // ìµœì†Œ 60ë°”ì´íŠ¸ í”„ë ˆì„ ìƒì„± (FCS ì œì™¸)
    int frameLength = Math.max(60, 14 + length);
    byte[] frame = new byte[frameLength];
    
    // í—¤ë” êµ¬ì„±
    System.arraycopy(destinationMacAddress, 0, frame, 0, 6);   // ëª©ì ì§€ MAC
    System.arraycopy(sourceMacAddress, 0, frame, 6, 6);        // ì¶œë°œì§€ MAC
    frame[12] = (byte) ((etherType >> 8) & 0xFF);              // EtherType ìƒìœ„
    frame[13] = (byte) (etherType & 0xFF);                     // EtherType í•˜ìœ„
    
    // í˜ì´ë¡œë“œ ë³µì‚¬
    System.arraycopy(input, 0, frame, 14, length);
    
    return lowerLayer.Send(frame, frame.length);
}
```

**í•µì‹¬ ë¡œì§ - Receive (ì—­ë‹¤ì¤‘í™”)**:
```java
public boolean Receive(byte[] input) {
    // 1. ìê¸° ìˆ˜ì‹  ë°©ì§€ (ì¶œë°œì§€ MAC == ë‚´ MAC)
    if (isSourceMe) return false;
    
    // 2. ëª©ì ì§€ í•„í„° (ë‚´ MAC ë˜ëŠ” ë¸Œë¡œë“œìºìŠ¤íŠ¸ë§Œ ìˆ˜ë½)
    if (!isDestinationMe && !isBroadcast) return false;
    
    // 3. EtherType íŒŒì‹±
    int etherType = ((input[12] & 0xFF) << 8) | (input[13] & 0xFF);
    
    // 4. ì—­ë‹¤ì¤‘í™”
    if (etherType == 0x0800) {      // IPv4
        return ipLayer.Receive(payload);
    } else if (etherType == 0x0806) { // ARP
        return arpLayer.Receive(payload);
    }
}
```

---

### 3.3 ARPLayer (ì£¼ì†Œ ë³€í™˜, L2)

**íŒŒì¼**: `ARPLayer.java` (412 lines)

**ì—­í• **:
- IP ì£¼ì†Œ â†’ MAC ì£¼ì†Œ ë³€í™˜
- ARP ìºì‹œ í…Œì´ë¸” ê´€ë¦¬
- ARP Request/Reply ì²˜ë¦¬

**ARP íŒ¨í‚· êµ¬ì¡° (28ë°”ì´íŠ¸)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HW Type     â”‚ Proto Type  â”‚ HW Len â”‚Proto Lenâ”‚ Operation â”‚
â”‚  (2B)       â”‚   (2B)      â”‚ (1B)   â”‚  (1B)   â”‚   (2B)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Sender MAC (6B) â”‚ Sender IP (4B)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Target MAC (6B) â”‚ Target IP (4B)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HW Type: 0x0001 (Ethernet)
Proto Type: 0x0800 (IPv4)
Operation: 1=Request, 2=Reply
```

**ARP ë™ì‘ ê³¼ì •**:
```
1. [Host A] IP 192.168.0.5ì˜ MAC ì£¼ì†Œê°€ í•„ìš”í•¨
2. [Host A] ARP Request ë¸Œë¡œë“œìºìŠ¤íŠ¸: "192.168.0.5ì˜ MACì€?"
3. [Host B] ìì‹ ì˜ IPê°€ 192.168.0.5ì´ë©´ ARP Reply ì „ì†¡
4. [Host B â†’ A] "192.168.0.5ëŠ” AA:BB:CC:DD:EE:FFì…ë‹ˆë‹¤"
5. [Host A] ARP ìºì‹œì— ì €ì¥í•˜ì—¬ ì¬ì‚¬ìš©
```

**í•µì‹¬ ë©”ì„œë“œ**:
```java
// ARP Request ì „ì†¡
public boolean sendArpRequest(byte[] targetIp) {
    byte[] arpPacket = new byte[28];
    // ... íŒ¨í‚· êµ¬ì„±
    buffer.putShort((short) OPERATION_REQUEST);  // Operation = 1
    buffer.put(new byte[6]);  // Target MAC = 00:00:00:00:00:00 (ëª¨ë¦„)
    buffer.put(targetIp);
    return underLayer.Send(arpPacket, 28);
}

// ARP Reply ì „ì†¡
public boolean sendArpReply(byte[] targetMac, byte[] targetIp) {
    buffer.putShort((short) OPERATION_REPLY);  // Operation = 2
    buffer.put(targetMac);
    buffer.put(targetIp);
    return underLayer.Send(arpPacket, 28);
}

// ARP ìºì‹œ ì¡°íšŒ
public byte[] lookupArpCache(String ip) {
    return arpCache.get(ip);
}
```

---

### 3.4 IPLayer (ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ, L3)

**íŒŒì¼**: `IPLayer.java` (425 lines)

**ì—­í• **:
- IP í—¤ë” ìƒì„± (20ë°”ì´íŠ¸)
- í”„ë¡œí† ì½œ ë²ˆí˜¸ë¡œ ìƒìœ„ ê³„ì¸µ ì—­ë‹¤ì¤‘í™”
- TOS í•„ë“œë¡œ ìš°ì„ ìˆœìœ„ ì „ë‹¬
- ARP ì—°ë™í•˜ì—¬ ëª©ì ì§€ MAC íšë“

**IP í—¤ë” êµ¬ì¡° (20ë°”ì´íŠ¸)**:
```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¤
â”‚Versionâ”‚  IHL  â”‚    TOS    â”‚          Total Length             â”‚
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¤
â”‚         Identification        â”‚Flagsâ”‚    Fragment Offset      â”‚
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¤
â”‚    TTL    â”‚    Protocol   â”‚        Header Checksum            â”‚
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¤
â”‚                       Source IP Address                       â”‚
â”œâ”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¼â”€â”¤
â”‚                    Destination IP Address                     â”‚
â””â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”˜

TOS (Type of Service):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚  Precedence   â”‚ D â”‚ T â”‚ R â”‚ 0 â”‚
â”‚   (3 bits)    â”‚   â”‚   â”‚   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  111 = 0xE0 = ê¸´ê¸‰ (Network Control)
  000 = 0x00 = ì¼ë°˜ (Routine)
  001 = 0x20 = ë‚®ìŒ (Priority)
```

**í”„ë¡œí† ì½œ ë²ˆí˜¸**:
| ë²ˆí˜¸ | ìš©ë„ |
|-----|------|
| 6 | TCP (ë¯¸ì‚¬ìš©) |
| 17 | UDP (ë¯¸ì‚¬ìš©) |
| 253 | ChatApp (ì‚¬ìš©ì ì •ì˜) |
| 254 | FileApp (ì‚¬ìš©ì ì •ì˜) |

**í•µì‹¬ ë¡œì§ - Send**:
```java
public boolean Send(byte[] data, int length) {
    // 1. ARPë¡œ ëª©ì ì§€ MAC íšë“
    byte[] dstMac = arpLayer.lookupArpCache(dstIpString);
    if (dstMac == null) {
        arpLayer.sendArpRequest(destinationIpAddress);
        // ARP ì‘ë‹µ ëŒ€ê¸° í›„ ì¬ì‹œë„
    }
    
    // 2. IP í—¤ë” ìƒì„± (20ë°”ì´íŠ¸)
    byte[] ipPacket = new byte[20 + length];
    ipPacket[0] = (byte) ((IPV4_VERSION << 4) | IP_HEADER_LENGTH_UNITS);
    ipPacket[1] = (byte) currentTosValue;  // TOS í•„ë“œ (ìš°ì„ ìˆœìœ„)
    ipPacket[9] = (byte) currentProtocol;  // 253=Chat, 254=File
    System.arraycopy(sourceIpAddress, 0, ipPacket, 12, 4);
    System.arraycopy(destinationIpAddress, 0, ipPacket, 16, 4);
    System.arraycopy(data, 0, ipPacket, 20, length);
    
    // 3. Ethernet ê³„ì¸µì— ëª©ì ì§€ MAC ì„¤ì •
    ethernetLayer.setDstMac(dstMac);
    ethernetLayer.setEtherType(0x0800);  // IPv4
    
    return lowerLayer.Send(ipPacket, ipPacket.length);
}
```

**í•µì‹¬ ë¡œì§ - Receive (ì—­ë‹¤ì¤‘í™”)**:
```java
public boolean Receive(byte[] input) {
    // 1. í”„ë¡œí† ì½œ ë²ˆí˜¸ ì¶”ì¶œ
    int protocol = input[9] & 0xFF;
    
    // 2. TOSì—ì„œ ìš°ì„ ìˆœìœ„ ì¶”ì¶œ
    int tos = input[1] & 0xFF;
    
    // 3. í˜ì´ë¡œë“œ ì¶”ì¶œ (í—¤ë” 20ë°”ì´íŠ¸ ì´í›„)
    byte[] payload = Arrays.copyOfRange(input, 20, input.length);
    
    // 4. ì—­ë‹¤ì¤‘í™”
    if (protocol == PROTOCOL_CHAT_APP) {      // 253
        return chatAppLayer.Receive(payload);
    } else if (protocol == PROTOCOL_FILE_APP) { // 254
        return fileAppLayer.Receive(payload);
    }
}
```

---

### 3.5 ChatAppLayer (ì±„íŒ… ì‘ìš© ê³„ì¸µ, L7)

**íŒŒì¼**: `ChatAppLayer.java` (543 lines)

**ì—­í• **:
- ë¬¸ìì—´ ë©”ì‹œì§€ â†” ë°”ì´íŠ¸ ë°°ì—´ ë³€í™˜
- ê¸´ ë©”ì‹œì§€ Fragmentation/Reassembly
- **XOR ì•”í˜¸í™”** (ìƒˆ ê¸°ëŠ¥)
- **ìš°ì„ ìˆœìœ„ í** (ìƒˆ ê¸°ëŠ¥)
- **íƒ€ì„ìŠ¤íƒ¬í”„ ë¡œê¹…** (ìƒˆ ê¸°ëŠ¥)

**í™•ì¥ëœ íŒ¨í‚· í—¤ë” êµ¬ì¡°**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Type+Flag  â”‚ Priority â”‚ Timestamp â”‚ Sequence â”‚ Total Seqâ”‚  Data    â”‚
â”‚ (1 byte)   â”‚ (1 byte) â”‚ (8 bytes) â”‚ (4 bytes)â”‚ (4 bytes)â”‚ (ê°€ë³€)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚          â”‚           â”‚          â”‚
     â”‚             â”‚          â”‚           â”‚          â””â”€ Fragment ì´ ê°œìˆ˜
     â”‚             â”‚          â”‚           â””â”€ í˜„ì¬ Fragment ë²ˆí˜¸
     â”‚             â”‚          â””â”€ ì „ì†¡ ì‹œê° (ë°€ë¦¬ì´ˆ)
     â”‚             â””â”€ ìš°ì„ ìˆœìœ„ (0=HIGH, 1=NORMAL, 2=LOW)
     â””â”€ ìƒìœ„ 1ë¹„íŠ¸: ì•”í˜¸í™” í”Œë˜ê·¸ (0x80)
        í•˜ìœ„ 7ë¹„íŠ¸: ë©”ì‹œì§€ íƒ€ì… (0x01=ë‹¨ì¼, 0x02=Fragment)
```

**ë©”ì‹œì§€ íƒ€ì…**:
| ê°’ | ì´ë¦„ | ì„¤ëª… |
|----|------|------|
| 0x01 | MSG_TYPE_SINGLE | ë‹¨ì¼ ë©”ì‹œì§€ (Fragment ë¶ˆí•„ìš”) |
| 0x02 | MSG_TYPE_FRAGMENT | Fragmentí™”ëœ ë©”ì‹œì§€ |
| 0x80 | ENCRYPTION_FLAG | ì•”í˜¸í™” í”Œë˜ê·¸ (OR ì—°ì‚°) |

---

### 3.6 FileAppLayer (íŒŒì¼ ì‘ìš© ê³„ì¸µ, L7)

**íŒŒì¼**: `FileAppLayer.java` (409 lines)

**ì—­í• **:
- íŒŒì¼ì„ Fragmentë¡œ ë¶„í• í•˜ì—¬ ì „ì†¡
- ìˆ˜ì‹ í•œ Fragmentë¥¼ ì¬ì¡°ë¦½í•˜ì—¬ íŒŒì¼ ë³µì›
- ë³„ë„ Threadì—ì„œ ì „ì†¡ (ì±„íŒ…ê³¼ ë™ì‹œ ì‚¬ìš© ê°€ëŠ¥)

**íŒŒì¼ ì „ì†¡ í”„ë¡œí† ì½œ**:
```
1. FILE_START (0x01): íŒŒì¼ëª…, íŒŒì¼í¬ê¸°, ì´ Fragment ìˆ˜ ì „ì†¡
2. FILE_DATA (0x02): ì‹¤ì œ ë°ì´í„° ì „ì†¡ (1KB ë‹¨ìœ„)
3. FILE_END (0x03): ì „ì†¡ ì™„ë£Œ ì•Œë¦¼
```

---

## 4. ìƒˆë¡œìš´ ê¸°ëŠ¥ 3ê°€ì§€ ìƒì„¸

### 4.1 ğŸ”’ XOR ì•”í˜¸í™”

**êµ¬í˜„ ìœ„ì¹˜**: `ChatAppLayer.java`

**ì›ë¦¬**:
- XOR ì—°ì‚°ì˜ íŠ¹ì„±: `A XOR B XOR B = A`
- ê°™ì€ í‚¤ë¡œ ì•”í˜¸í™”í•˜ë©´ ë³µí˜¸í™”ë¨ (ëŒ€ì¹­ ì•”í˜¸)

**êµ¬í˜„ ì½”ë“œ**:
```java
private static final byte XOR_ENCRYPTION_KEY = 0x42;  // ì•”í˜¸í™” í‚¤

private byte[] applyXorEncryption(byte[] data, byte key) {
    byte[] result = new byte[data.length];
    for (int i = 0; i < data.length; i++) {
        result[i] = (byte) (data[i] ^ key);
    }
    return result;
}
```

**ì‚¬ìš© ì˜ˆì‹œ**:
```java
// ì•”í˜¸í™” í™œì„±í™”
chatLayer.setEncryptionEnabled(true);

// ì „ì†¡ ì‹œ ìë™ ì•”í˜¸í™”
chatLayer.sendMessage("Hello");  // í—¤ë”ì— 0x80 í”Œë˜ê·¸ ì„¤ì •

// ìˆ˜ì‹  ì‹œ ìë™ ë³µí˜¸í™”
// í—¤ë”ì˜ 0x80 í”Œë˜ê·¸ í™•ì¸ í›„ ë³µí˜¸í™” ìˆ˜í–‰
```

**ì•”í˜¸í™” í”Œë˜ê·¸**:
```
Type ë°”ì´íŠ¸:  [1][xxxxxxx]
              â”‚    â”‚
              â”‚    â””â”€ ë©”ì‹œì§€ íƒ€ì… (7ë¹„íŠ¸)
              â””â”€ ì•”í˜¸í™” í”Œë˜ê·¸ (1=ì•”í˜¸í™”ë¨)

ì˜ˆì‹œ:
- 0x01 = ë‹¨ì¼ ë©”ì‹œì§€, í‰ë¬¸
- 0x81 = ë‹¨ì¼ ë©”ì‹œì§€, ì•”í˜¸í™”ë¨ (0x80 | 0x01)
- 0x02 = Fragment ë©”ì‹œì§€, í‰ë¬¸
- 0x82 = Fragment ë©”ì‹œì§€, ì•”í˜¸í™”ë¨
```

---

### 4.2 âš¡ ìš°ì„ ìˆœìœ„ í

**êµ¬í˜„ ìœ„ì¹˜**: `ChatAppLayer.java` + `IPLayer.java`

**ìš°ì„ ìˆœìœ„ ë ˆë²¨**:
| ë ˆë²¨ | TOS ê°’ | ìˆœì„œ | ë¼ë²¨ |
|------|--------|------|------|
| HIGH | 0xE0 (224) | 0 | [ê¸´ê¸‰] |
| NORMAL | 0x00 (0) | 1 | [ì¼ë°˜] |
| LOW | 0x20 (32) | 2 | [ë‚®ìŒ] |

**ë™ì‘ ì›ë¦¬**:
1. ì „ì†¡ ì‹œ ìš°ì„ ìˆœìœ„ë¥¼ íŒ¨í‚· í—¤ë”ì— í¬í•¨
2. IPLayerì—ì„œ TOS í•„ë“œì— ìš°ì„ ìˆœìœ„ ê°’ ì„¤ì •
3. ìˆ˜ì‹  ì‹œ PriorityBlockingQueueì— ë©”ì‹œì§€ ì¶”ê°€
4. ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ì²˜ë¦¬

**êµ¬í˜„ ì½”ë“œ**:
```java
// ìš°ì„ ìˆœìœ„ enum
public enum Priority {
    HIGH(0, "[ê¸´ê¸‰]"),
    NORMAL(1, "[ì¼ë°˜]"),
    LOW(2, "[ë‚®ìŒ]");
    
    public final int order;
    public final String label;
}

// ìš°ì„ ìˆœìœ„ ë¹„êµ (PrioritizedMessage)
@Override
public int compareTo(PrioritizedMessage other) {
    // 1. ìš°ì„ ìˆœìœ„ê°€ ë†’ì„ìˆ˜ë¡ ë¨¼ì € (order ê°’ì´ ì‘ì„ìˆ˜ë¡)
    int cmp = Integer.compare(this.priority.order, other.priority.order);
    if (cmp != 0) return cmp;
    // 2. ê°™ì€ ìš°ì„ ìˆœìœ„ë©´ FIFO
    return Long.compare(this.queuedAt, other.queuedAt);
}

// ë©”ì‹œì§€ ì²˜ë¦¬ ìŠ¤ë ˆë“œ
private void startMessageProcessor() {
    messageProcessorThread = new Thread(() -> {
        while (isProcessorRunning) {
            PrioritizedMessage msg = priorityMessageQueue.take();  // ìš°ì„ ìˆœìœ„ ìˆœ
            // ë©”ì‹œì§€ ì²˜ë¦¬ ë° UI ì—…ë°ì´íŠ¸
        }
    });
}
```

---

### 4.3 ğŸ“Š íƒ€ì„ìŠ¤íƒ¬í”„ & ë¡œê¹…

**êµ¬í˜„ ìœ„ì¹˜**: `ChatAppLayer.java`

**íƒ€ì„ìŠ¤íƒ¬í”„ êµ¬ì¡°**:
- 8ë°”ì´íŠ¸ (long) ë°€ë¦¬ì´ˆ ë‹¨ìœ„
- ì „ì†¡ ì‹œì ì˜ `System.currentTimeMillis()` ê°’

**ì§€ì—°ì‹œê°„ ê³„ì‚°**:
```java
long sentTimestamp = extractTimestampFromPacket(packet);  // íŒ¨í‚·ì—ì„œ ì¶”ì¶œ
long receivedAt = System.currentTimeMillis();              // í˜„ì¬ ì‹œê°„
long latency = receivedAt - sentTimestamp;                 // ì§€ì—°ì‹œê°„ (ms)
```

**ë¡œê¹… ì‹œìŠ¤í…œ**:
- íŒŒì¼: `packet.log`
- í˜•ì‹: `[YYYY-MM-DD HH:mm:ss.SSS] [ACTION] message`

**ë¡œê·¸ ì˜ˆì‹œ**:
```
2024-12-06 15:30:45.123 [SEND] Hello World [ì•”í˜¸í™”ë¨] (timestamp=1701851445123)
2024-12-06 15:30:45.156 [RECV] Hello World (sent=1701851445123, received=1701851445156, latency=33ms)
```

**êµ¬í˜„ ì½”ë“œ**:
```java
private static final String LOG_FILE_PATH = "packet.log";
private static PrintWriter logFileWriter;
private static final SimpleDateFormat DATE_FORMAT = 
    new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.SSS");

private void log(String action, String message) {
    String timestamp = DATE_FORMAT.format(new Date());
    String logLine = String.format("%s [%s] %s", timestamp, action, message);
    logFileWriter.println(logLine);
    System.out.println("[ChatApp:LOG] " + logLine);
}
```

---

## 5. íŒ¨í‚· êµ¬ì¡° ë¶„ì„

### 5.1 ì „ì²´ íŒ¨í‚· êµ¬ì¡° (ì†¡ì‹  ì‹œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ethernet Frame                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dst MAC  â”‚ Src MAC  â”‚EtherType â”‚              Payload               â”‚
â”‚  (6B)    â”‚  (6B)    â”‚  (2B)    â”‚                                    â”‚
â”‚          â”‚          â”‚  0x0800  â”‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚           IP Packet                â”‚
â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚ IP Headerâ”‚       Payload           â”‚
â”‚                                â”‚  (20B)   â”‚                         â”‚
â”‚                                â”‚ TOS=0xE0 â”‚                         â”‚
â”‚                                â”‚Proto=253 â”‚                         â”‚
â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚          â”‚   ChatApp Packet        â”‚
â”‚                                â”‚          â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”¤
â”‚                                â”‚          â”‚Typeâ”‚Prioâ”‚TS  â”‚Seq â”‚Tot â”‚Data
â”‚                                â”‚          â”‚(1B)â”‚(1B)â”‚(8B)â”‚(4B)â”‚(4B)â”‚
â”‚                                â”‚          â”‚0x81â”‚ 0  â”‚... â”‚ 0  â”‚ 1  â”‚...
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”˜
```

### 5.2 ë°”ì´íŠ¸ ë‹¨ìœ„ ë¶„ì„ ì˜ˆì‹œ

**"Hello" ë©”ì‹œì§€ (ì•”í˜¸í™”ë¨, ê¸´ê¸‰) ì „ì†¡ ì‹œ**:

```
=== Ethernet Header (14 bytes) ===
[0-5]   Dst MAC: AA:BB:CC:DD:EE:FF
[6-11]  Src MAC: 11:22:33:44:55:66
[12-13] EtherType: 08 00 (IPv4)

=== IP Header (20 bytes) ===
[14]    Version+IHL: 45 (v4, 20bytes)
[15]    TOS: E0 (HIGH priority)
[16-17] Total Length: 00 33 (51 bytes)
[18-19] Identification: 00 01
[20-21] Flags+Offset: 00 00
[22]    TTL: 80 (128)
[23]    Protocol: FD (253 = ChatApp)
[24-25] Checksum: XX XX
[26-29] Src IP: C0 A8 01 0A (192.168.1.10)
[30-33] Dst IP: C0 A8 01 14 (192.168.1.20)

=== ChatApp Header (18 bytes) ===
[34]    Type+Flag: 81 (0x80|0x01 = ì•”í˜¸í™”+ë‹¨ì¼)
[35]    Priority: 00 (HIGH)
[36-43] Timestamp: 00 00 01 8C 5A 2B 3C D0 (ë°€ë¦¬ì´ˆ)
[44-47] Sequence: 00 00 00 00
[48-51] Total: 00 00 00 01

=== Data (ì•”í˜¸í™”ëœ "Hello") ===
[52-56] Data: 0A 27 2E 2E 2D (XOR 0x42)
        ì›ë³¸: H  e  l  l  o
        ASCII: 48 65 6C 6C 6F
        XOR:   0A 27 2E 2E 2D
```

---

## 6. ë°ì´í„° íë¦„ ì¶”ì 

### 6.1 ë©”ì‹œì§€ ì „ì†¡ íë¦„

```
ì‚¬ìš©ì ì…ë ¥: "Hello" (ì•”í˜¸í™” ON, ìš°ì„ ìˆœìœ„ HIGH)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkChatApp.sendMessage()                                        â”‚
â”‚ - ë©”ì‹œì§€ í•„ë“œì—ì„œ í…ìŠ¤íŠ¸ íšë“                                    â”‚
â”‚ - ì•”í˜¸í™” ì²´í¬ë°•ìŠ¤, ìš°ì„ ìˆœìœ„ ì½¤ë³´ë°•ìŠ¤ ê°’ ì½ê¸°                      â”‚
â”‚ - chatLayer.setEncryptionEnabled(true)                          â”‚
â”‚ - chatLayer.setPriority(Priority.HIGH)                          â”‚
â”‚ - chatLayer.sendMessage("Hello")                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatAppLayer.sendMessage("Hello")                               â”‚
â”‚ 1. íƒ€ì„ìŠ¤íƒ¬í”„ ìƒì„±: sentTimestamp = System.currentTimeMillis()  â”‚
â”‚ 2. UTF-8 ì¸ì½”ë”©: messageBytes = "Hello".getBytes(UTF_8)         â”‚
â”‚ 3. XOR ì•”í˜¸í™”: dataToSend = applyXorEncryption(messageBytes)    â”‚
â”‚ 4. í—¤ë” ìƒì„±:                                                   â”‚
â”‚    - Type = 0x81 (ì•”í˜¸í™” + ë‹¨ì¼)                                â”‚
â”‚    - Priority = 0 (HIGH)                                        â”‚
â”‚    - Timestamp = sentTimestamp                                  â”‚
â”‚ 5. ë¡œê·¸ ê¸°ë¡                                                    â”‚
â”‚ 6. lowerLayer.Send(packet, length)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPLayer.Send(data, length)                                      â”‚
â”‚ 1. ARP ìºì‹œì—ì„œ ëª©ì ì§€ MAC ì¡°íšŒ                                      â”‚
â”‚    - ì—†ìœ¼ë©´ ARP Request ì „ì†¡ í›„ ëŒ€ê¸°                                 â”‚
â”‚ 2. IP í—¤ë” ìƒì„± (20ë°”ì´íŠ¸)                                          â”‚
â”‚    - TOS = 0xE0 (HIGH priority)                                 â”‚
â”‚    - Protocol = 253 (ChatApp)                                   â”‚
â”‚ 3. ethernetLayer.setDstMac(dstMac)                             â”‚
â”‚ 4. ethernetLayer.setEtherType(0x0800)                          â”‚
â”‚ 5. lowerLayer.Send(ipPacket, length)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EthernetLayer.Send(data, length)                                â”‚
â”‚ 1. í”„ë ˆì„ í¬ê¸° ê³„ì‚° (ìµœì†Œ 60ë°”ì´íŠ¸)                              â”‚
â”‚ 2. í—¤ë” êµ¬ì„±:                                                   â”‚
â”‚    - ëª©ì ì§€ MAC (6B)                                            â”‚
â”‚    - ì¶œë°œì§€ MAC (6B)                                            â”‚
â”‚    - EtherType 0x0800 (2B)                                      â”‚
â”‚ 3. í˜ì´ë¡œë“œ ë³µì‚¬                                                â”‚
â”‚ 4. lowerLayer.Send(frame, length)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PhysicalLayer.Send(data, length)                                â”‚
â”‚ 1. ByteBuffer ë˜í•‘                                              â”‚
â”‚ 2. pcap.sendPacket(buffer)                                      â”‚
â”‚ 3. NICê°€ FCS ì¶”ê°€ í›„ ë¬¼ë¦¬ì  ì „ì†¡                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
   [ë„¤íŠ¸ì›Œí¬ ì „ì†¡]
```

### 6.2 ë©”ì‹œì§€ ìˆ˜ì‹  íë¦„

```
   [ë„¤íŠ¸ì›Œí¬ ìˆ˜ì‹ ]
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PhysicalLayer.run() - ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œ                         â”‚
â”‚ 1. pcap.dispatch(1, handler, this)                              â”‚
â”‚ 2. íŒ¨í‚· ìˆ˜ì‹  ì‹œ handler í˜¸ì¶œ                                    â”‚
â”‚ 3. ìƒìœ„ ê³„ì¸µìœ¼ë¡œ ì „ë‹¬: upperLayer.Receive(packet)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EthernetLayer.Receive(frame)                                    â”‚
â”‚ 1. ìê¸° ìˆ˜ì‹  ë°©ì§€ (ì¶œë°œì§€ MAC == ë‚´ MAC â†’ ë“œë¡­)                 â”‚
â”‚ 2. ëª©ì ì§€ í•„í„° (ë‚´ MAC ë˜ëŠ” ë¸Œë¡œë“œìºìŠ¤íŠ¸ë§Œ ìˆ˜ë½)                â”‚
â”‚ 3. EtherType íŒŒì‹±: 0x0800                                       â”‚
â”‚ 4. í˜ì´ë¡œë“œ ì¶”ì¶œ (14ë°”ì´íŠ¸ ì´í›„)                                â”‚
â”‚ 5. ì—­ë‹¤ì¤‘í™”: ipLayer.Receive(payload)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPLayer.Receive(packet)                                         â”‚
â”‚ 1. Protocol íŒŒì‹±: 253                                           â”‚
â”‚ 2. TOS íŒŒì‹±: 0xE0 â†’ Priority.HIGH                               â”‚
â”‚ 3. í˜ì´ë¡œë“œ ì¶”ì¶œ (20ë°”ì´íŠ¸ ì´í›„)                                â”‚
â”‚ 4. ì—­ë‹¤ì¤‘í™”: chatAppLayer.Receive(payload)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatAppLayer.Receive(packet)                                    â”‚
â”‚ 1. Type ë°”ì´íŠ¸ íŒŒì‹±:                                            â”‚
â”‚    - ì•”í˜¸í™” í”Œë˜ê·¸ = (type & 0x80) != 0                         â”‚
â”‚    - ë©”ì‹œì§€ íƒ€ì… = type & 0x7F                                  â”‚
â”‚ 2. Priority íŒŒì‹±: 0 â†’ HIGH                                      â”‚
â”‚ 3. Timestamp íŒŒì‹±: sentTimestamp                                â”‚
â”‚ 4. ë°ì´í„° ì¶”ì¶œ                                                  â”‚
â”‚ 5. ë³µí˜¸í™”: applyXorEncryption(data, KEY)                        â”‚
â”‚ 6. UTF-8 ë””ì½”ë”©: new String(data, UTF_8)                        â”‚
â”‚ 7. ìš°ì„ ìˆœìœ„ íì— ì¶”ê°€: priorityMessageQueue.add(msg)            â”‚
â”‚ 8. ë¡œê·¸ ê¸°ë¡                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MessageProcessor Thread (ë°±ê·¸ë¼ìš´ë“œ)                            â”‚
â”‚ 1. priorityMessageQueue.take() - ìš°ì„ ìˆœìœ„ ìˆœ ì¶”ì¶œ               â”‚
â”‚ 2. ì§€ì—°ì‹œê°„ ê³„ì‚°: latency = now - sentTimestamp                 â”‚
â”‚ 3. ì½œë°± í˜¸ì¶œ: messageReceivedCallback.accept(message)           â”‚
â”‚ 4. UI ì—…ë°ì´íŠ¸                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NetworkChatApp (GUI)                                                â”‚
â”‚ 1. textArea.append("[ê¸´ê¸‰] Hello (ì§€ì—°: 15ms)")                 â”‚
â”‚ 2. latencyLabel.setText("ì§€ì—°ì‹œê°„: 15ms")                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. í•µì‹¬ ì•Œê³ ë¦¬ì¦˜

### 7.1 Fragmentation (ë©”ì‹œì§€ ë¶„í• )

**ëª©ì **: ìµœëŒ€ ì „ì†¡ í¬ê¸°(MTU)ë¥¼ ì´ˆê³¼í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì‘ì€ ì¡°ê°ìœ¼ë¡œ ë¶„í• 

**ì•Œê³ ë¦¬ì¦˜**:
```java
int MAX_FRAGMENT_SIZE = 512;  // Fragmentë‹¹ ìµœëŒ€ í¬ê¸°

if (data.length <= MAX_FRAGMENT_SIZE) {
    // ë‹¨ì¼ ë©”ì‹œì§€ë¡œ ì „ì†¡
    sendSingleMessage(data);
} else {
    // Fragmentí™”
    int fragmentCount = (int) Math.ceil((double) data.length / MAX_FRAGMENT_SIZE);
    
    for (int seq = 0; seq < fragmentCount; seq++) {
        int offset = seq * MAX_FRAGMENT_SIZE;
        int len = Math.min(MAX_FRAGMENT_SIZE, data.length - offset);
        
        byte[] fragment = new byte[len];
        System.arraycopy(data, offset, fragment, 0, len);
        
        // í—¤ë”: [Type=0x02][Priority][Timestamp][Seq=seq][Total=fragmentCount]
        sendFragment(fragment, seq, fragmentCount);
    }
}
```

### 7.2 Reassembly (ë©”ì‹œì§€ ì¬ì¡°ë¦½)

**ëª©ì **: ë¶„í• ë˜ì–´ ìˆ˜ì‹ ëœ Fragmentë“¤ì„ ì›ë³¸ ë©”ì‹œì§€ë¡œ ë³µì›

**ì•Œê³ ë¦¬ì¦˜**:
```java
// ì¬ì¡°ë¦½ ë²„í¼ (ë©”ì‹œì§€ IDë³„ë¡œ ê´€ë¦¬)
Map<Integer, MessageReassemblyBuffer> reassemblyBuffers = new ConcurrentHashMap<>();

public void handleFragment(int messageId, int seq, int total, byte[] data) {
    // 1. ë²„í¼ ìƒì„± ë˜ëŠ” ì¡°íšŒ
    MessageReassemblyBuffer buffer = reassemblyBuffers.computeIfAbsent(
        messageId, id -> new MessageReassemblyBuffer(total)
    );
    
    // 2. Fragment ì €ì¥
    buffer.receivedFragments.put(seq, data);
    buffer.receivedSequences++;
    
    // 3. ì™„ë£Œ ì²´í¬
    if (buffer.isComplete()) {
        byte[] fullMessage = buffer.reassembleMessage();
        reassemblyBuffers.remove(messageId);
        processCompleteMessage(fullMessage);
    }
}
```

### 7.3 IP ì²´í¬ì„¬ ê³„ì‚°

**ëª©ì **: IP í—¤ë” ë¬´ê²°ì„± ê²€ì¦

**ì•Œê³ ë¦¬ì¦˜**:
```java
private int calculateChecksum(byte[] header) {
    int sum = 0;
    
    // 16ë¹„íŠ¸ ë‹¨ìœ„ë¡œ í•©ì‚°
    for (int i = 0; i < header.length; i += 2) {
        int word = ((header[i] & 0xFF) << 8);
        if (i + 1 < header.length) {
            word |= (header[i + 1] & 0xFF);
        }
        sum += word;
    }
    
    // ìºë¦¬ ì˜¤ë²„ ì²˜ë¦¬
    while ((sum >> 16) > 0) {
        sum = (sum & 0xFFFF) + (sum >> 16);
    }
    
    // 1ì˜ ë³´ìˆ˜
    return ~sum & 0xFFFF;
}
```

---

## 8. GUI êµ¬ì„±

### 8.1 ì£¼ìš” ì»´í¬ë„ŒíŠ¸ (NetworkChatApp.java)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Network Chat Application                                      [_][â–¡][X]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ì¥ì¹˜ ì„ íƒ: [en0 - 192.168.1.10 â–¼]                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ ë‚´ IP: 192.168.1.10  â”‚ â”‚ ëª©ì ì§€ IP: 192.168.1.20 â”‚                  â”‚
â”‚ â”‚ ë‚´ MAC: AA:BB:CC:... â”‚ â”‚ [ARP ì¡°íšŒ]              â”‚                  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ARP ìºì‹œ í…Œì´ë¸”                                                    â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚ â”‚
â”‚ â”‚ â”‚ IP ì£¼ì†Œ        â”‚ MAC ì£¼ì†Œ            â”‚                          â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚ â”‚
â”‚ â”‚ â”‚ 192.168.1.20   â”‚ 11:22:33:44:55:66   â”‚                        â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [âœ“] ì•”í˜¸í™”    ìš°ì„ ìˆœìœ„: [ì¼ë°˜ â–¼]    ì§€ì—°ì‹œê°„: 15ms                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                                 â”‚ â”‚
â”‚ â”‚ [15:30:45] [ê¸´ê¸‰] ì•ˆë…•í•˜ì„¸ìš”! (ì§€ì—°: 12ms)                           â”‚ â”‚
â”‚ â”‚ [15:30:48] [ì¼ë°˜] ë°˜ê°‘ìŠµë‹ˆë‹¤. (ì§€ì—°: 15ms)                           â”‚ â”‚
â”‚ â”‚ [15:31:02] [ë‚®ìŒ] ë‚˜ì¤‘ì— ë´ìš”. (ì§€ì—°: 8ms)                           â”‚ â”‚
â”‚ â”‚                                                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ë©”ì‹œì§€: [ì•ˆë…•í•˜ì„¸ìš”!                        ] [ì „ì†¡]                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ íŒŒì¼: [/path/to/file.txt               ] [ì „ì†¡] [â– â– â– â– â–‘â–‘â–‘â–‘ 50%]     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ì´ë²¤íŠ¸ ì²˜ë¦¬

```java
// ë©”ì‹œì§€ ì „ì†¡ ë²„íŠ¼
sendButton.addActionListener(e -> {
    String message = messageField.getText();
    if (!message.isEmpty()) {
        // ì•”í˜¸í™”/ìš°ì„ ìˆœìœ„ ì„¤ì •
        chatLayer.setEncryptionEnabled(encryptCheckbox.isSelected());
        chatLayer.setPriority(getSelectedPriority());
        
        // ì „ì†¡
        chatLayer.sendMessage(message);
        messageField.setText("");
    }
});

// ë©”ì‹œì§€ ìˆ˜ì‹  ì½œë°±
chatLayer.setOnReceiveWithLatency((message, latency) -> {
    SwingUtilities.invokeLater(() -> {
        textArea.append(message + "\n");
        latencyLabel.setText("ì§€ì—°ì‹œê°„: " + latency + "ms");
    });
});
```

---

## 9. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì„¤ëª…

### 9.1 í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ êµ¬ì¡°

| í´ë˜ìŠ¤ | í…ŒìŠ¤íŠ¸ ìˆ˜ | ëª©ì  |
|--------|----------|------|
| NewFeaturesTest | 14 | ìƒˆë¡œìš´ ê¸°ëŠ¥ 3ê°€ì§€ ê²€ì¦ |
| ChatAppLayerTest | 5 | ê¸°ë³¸ ì±„íŒ… ê¸°ëŠ¥ ê²€ì¦ |
| FileAppLayerTest | 3 | íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥ ê²€ì¦ |
| IPLayerDemuxTest | 3 | IP ì—­ë‹¤ì¤‘í™” ê²€ì¦ |

### 9.2 ì£¼ìš” í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

**ì•”í˜¸í™” í…ŒìŠ¤íŠ¸**:
```java
@Test
void testXorEncryptionDecryption() {
    String original = "Hello, World!";
    byte[] encrypted = chatLayer.encrypt(original.getBytes());
    byte[] decrypted = chatLayer.decrypt(encrypted);
    assertEquals(original, new String(decrypted));
}
```

**ìš°ì„ ìˆœìœ„ í…ŒìŠ¤íŠ¸**:
```java
@Test
void testPriorityQueueOrdering() {
    // LOW â†’ NORMAL â†’ HIGH ìˆœìœ¼ë¡œ ì¶”ê°€
    queue.add(new Message("Low", Priority.LOW));
    queue.add(new Message("Normal", Priority.NORMAL));
    queue.add(new Message("High", Priority.HIGH));
    
    // HIGH â†’ NORMAL â†’ LOW ìˆœìœ¼ë¡œ ì¶”ì¶œ
    assertEquals("High", queue.take().content);
    assertEquals("Normal", queue.take().content);
    assertEquals("Low", queue.take().content);
}
```

**íƒ€ì„ìŠ¤íƒ¬í”„ í…ŒìŠ¤íŠ¸**:
```java
@Test
void testTimestampLatencyCalculation() {
    long sentTime = 1000L;
    long receivedTime = 1050L;
    long latency = receivedTime - sentTime;
    assertEquals(50L, latency);
}
```

### 9.3 í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
mvn test

# íŠ¹ì • í´ë˜ìŠ¤ë§Œ ì‹¤í–‰
mvn test -Dtest=NewFeaturesTest

# íŠ¹ì • ë©”ì„œë“œë§Œ ì‹¤í–‰
mvn test -Dtest=NewFeaturesTest#testXorEncryption
```

---

## 10. ì‹¤í–‰ í™˜ê²½ ë° ì˜ì¡´ì„±

### 10.1 ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

| í•­ëª© | ìš”êµ¬ì‚¬í•­ |
|------|----------|
| OS | macOS, Linux (WindowsëŠ” Docker ì‚¬ìš©) |
| Java | JDK 21+ (--enable-preview í•„ìš”) |
| ê¶Œí•œ | ê´€ë¦¬ì ê¶Œí•œ (sudo) - íŒ¨í‚· ìº¡ì²˜ìš© |
| ë¼ì´ë¸ŒëŸ¬ë¦¬ | libpcap (ë¡œì»¬ ì‹¤í–‰ ì‹œ) |

### 10.2 í•µì‹¬ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ëª…

#### 10.2.1 libpcap / Npcap / WinPcap ì´ë€?

**libpcap** (Packet Capture Library)ì€ ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ìº¡ì²˜í•˜ê¸° ìœ„í•œ **C ë¼ì´ë¸ŒëŸ¬ë¦¬**ì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì‚¬ìš©ì ì• í”Œë¦¬ì¼€ì´ì…˜                             â”‚
â”‚                  (Wireshark, tcpdump, ìš°ë¦¬ í”„ë¡œê·¸ë¨)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ libpcap API í˜¸ì¶œ
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    libpcap / Npcap / WinPcap                    â”‚
â”‚                     (íŒ¨í‚· ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ì‹œìŠ¤í…œ ì½œ
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ìš´ì˜ì²´ì œ ì»¤ë„                              â”‚
â”‚                    (BPF / NDIS ë“œë¼ì´ë²„)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    [ ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ (NIC) ]
```

**ìš´ì˜ì²´ì œë³„ íŒ¨í‚· ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬**:

| ë¼ì´ë¸ŒëŸ¬ë¦¬ | ìš´ì˜ì²´ì œ | ì„¤ëª… |
|-----------|---------|------|
| **libpcap** | macOS, Linux | ì›ì¡° íŒ¨í‚· ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ (1994ë…„~) |
| **WinPcap** | Windows | libpcapì˜ Windows í¬íŒ… (2013ë…„ ê°œë°œ ì¤‘ë‹¨) |
| **Npcap** | Windows | WinPcap í›„ì†, ìµœì‹  Windows ì§€ì› (í˜„ì¬ í™œë°œíˆ ê°œë°œ ì¤‘) |

**Npcap vs WinPcap ì°¨ì´ì **:

| í•­ëª© | WinPcap | Npcap |
|------|---------|-------|
| ìµœì‹  Windows ì§€ì› | âŒ (Windows 10 ì´í›„ ë¬¸ì œ) | âœ… Windows 11ê¹Œì§€ ì§€ì› |
| ê°œë°œ ìƒíƒœ | ì¤‘ë‹¨ë¨ (2013) | í™œë°œí•¨ (Wireshark íŒ€ ìœ ì§€ë³´ìˆ˜) |
| ë£¨í”„ë°± ìº¡ì²˜ | âŒ | âœ… ì§€ì› |
| ë³´ì•ˆ | ì˜¤ë˜ëœ ë“œë¼ì´ë²„ | ìµœì‹  ë³´ì•ˆ íŒ¨ì¹˜ ì ìš© |
| ê¶Œì¥ ì—¬ë¶€ | âŒ ë¹„ê¶Œì¥ | âœ… ê¶Œì¥ |

**ì™œ ê´€ë¦¬ì ê¶Œí•œ(sudo)ì´ í•„ìš”í•œê°€?**

íŒ¨í‚· ìº¡ì²˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì˜ **raw ë°ì´í„°**ì— ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ë³´ì•ˆìƒ ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ í—ˆìš©ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.

```bash
# ì¼ë°˜ ì‚¬ìš©ìë¡œ ì‹¤í–‰ ì‹œ
$ ./run.sh
Error: Permission denied - Cannot open network interface

# ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
$ sudo ./run.sh
âœ… Network interface opened successfully
```

---

#### 10.2.2 jNetPcapì´ë€?

**jNetPcap**ì€ libpcapì„ **Javaì—ì„œ ì‚¬ìš©**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë˜í¼(wrapper) ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ìš°ë¦¬ Java í”„ë¡œê·¸ë¨                              â”‚
â”‚               (NetworkChatApp, PhysicalLayer ë“±)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Java ë©”ì„œë“œ í˜¸ì¶œ
                            â”‚ Pcap.openLive(), pcap.sendPacket()
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                jNetPcap (Java ë¼ì´ë¸ŒëŸ¬ë¦¬)                          â”‚
â”‚           jnetpcap-wrapper-2.3.1-jdk21.jar                      â”‚
â”‚                                                                 â”‚
â”‚  â€¢ Java Foreign Function Interface (FFI) ì‚¬ìš©                    â”‚
â”‚  â€¢ JNI (Java Native Interface) ëŒ€ì²´                              â”‚
â”‚  â€¢ Java 21+ --enable-native-access í•„ìš”                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ë„¤ì´í‹°ë¸Œ í˜¸ì¶œ
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               libpcap / Npcap (C ë¼ì´ë¸ŒëŸ¬ë¦¬)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
                    [ ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ ]
```

**jNetPcap ì£¼ìš” í´ë˜ìŠ¤**:

| í´ë˜ìŠ¤ | ì—­í•  | ì‚¬ìš© ìœ„ì¹˜ |
|--------|------|----------|
| `Pcap` | íŒ¨í‚· ìº¡ì²˜ ì„¸ì…˜ ê´€ë¦¬ | PhysicalLayer |
| `PcapIf` | ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ | NetworkChatApp (ì¥ì¹˜ ì„ íƒ) |
| `PcapException` | íŒ¨í‚· ìº¡ì²˜ ì—ëŸ¬ | ì˜ˆì™¸ ì²˜ë¦¬ |
| `PcapHandler` | íŒ¨í‚· ìˆ˜ì‹  ì½œë°± | PhysicalLayer.run() |

**ì™œ jNetPcapì¸ê°€?**

ì¼ë°˜ì ì¸ Java ë„¤íŠ¸ì›Œí¬ í”„ë¡œê·¸ë˜ë°ì€ **ì†Œì¼“ API**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:
```java
// ì¼ë°˜ì ì¸ Java ë„¤íŠ¸ì›Œí¬ (TCP ì†Œì¼“)
Socket socket = new Socket("192.168.1.1", 8080);
socket.getOutputStream().write(data);
```

í•˜ì§€ë§Œ ì†Œì¼“ APIëŠ” **IP ê³„ì¸µ ì´ìƒ**ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤. ìš°ë¦¬ í”„ë¡œì íŠ¸ëŠ” **Ethernet í”„ë ˆì„**ì„ ì§ì ‘ ë‹¤ë£¨ì–´ì•¼ í•˜ë¯€ë¡œ ë” ë‚®ì€ ë ˆë²¨ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤:

```java
// ìš°ë¦¬ í”„ë¡œì íŠ¸ (jNetPcap ì‚¬ìš©)
Pcap pcap = Pcap.openLive(device, snaplen, promiscuous, timeout, unit);
pcap.sendPacket(ByteBuffer.wrap(ethernetFrame));  // Ethernet í”„ë ˆì„ ì§ì ‘ ì „ì†¡!
```

**jNetPcap ë²„ì „ ì •ë³´**:
- ì‚¬ìš© ë²„ì „: `jnetpcap-wrapper-2.3.1-jdk21.jar`
- Java 21 ì „ìš© (Foreign Function Interface ì‚¬ìš©)
- `--enable-preview` ë° `--enable-native-access=ALL-UNNAMED` í”Œë˜ê·¸ í•„ìš”

---

### 10.3 Maven ì˜ì¡´ì„± ìƒì„¸ ì„¤ëª…

```xml
<dependencies>
    <!-- jNetPcap - íŒ¨í‚· ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <dependency>
        <groupId>org.jnetpcap</groupId>
        <artifactId>jnetpcap-wrapper</artifactId>
        <version>2.3.1</version>
        <scope>system</scope>
        <systemPath>${project.basedir}/lib/jnetpcap-wrapper-2.3.1-jdk21.jar</systemPath>
    </dependency>
    
    <!-- JUnit 5 - í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ -->
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.10.0</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-engine</artifactId>
        <version>5.10.0</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

**ì˜ì¡´ì„± ì„¤ëª…**:

| ì˜ì¡´ì„± | ì—­í•  | ì™œ í•„ìš”í•œê°€? |
|--------|------|------------|
| **jnetpcap-wrapper** | íŒ¨í‚· ìº¡ì²˜ | Ethernet í”„ë ˆì„ ì§ì ‘ ì†¡ìˆ˜ì‹  |
| **junit-jupiter-api** | í…ŒìŠ¤íŠ¸ ì–´ë…¸í…Œì´ì…˜ | `@Test`, `@BeforeEach` ë“± |
| **junit-jupiter-engine** | í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì—”ì§„ | JUnit 5 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ |

**scope ì„¤ëª…**:

| Scope | ì˜ë¯¸ | ì˜ˆì‹œ |
|-------|------|------|
| `compile` (ê¸°ë³¸) | ì»´íŒŒì¼, ëŸ°íƒ€ì„ ëª¨ë‘ í•„ìš” | - |
| `test` | í…ŒìŠ¤íŠ¸ ì‹œì—ë§Œ í•„ìš” | JUnit |
| `system` | ë¡œì»¬ JAR íŒŒì¼ ì§ì ‘ ì§€ì • | jNetPcap |

---

### 10.4 Maven í”ŒëŸ¬ê·¸ì¸ ì„¤ëª…

```xml
<plugins>
    <!-- 1. ì»´íŒŒì¼ëŸ¬ í”ŒëŸ¬ê·¸ì¸ -->
    <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.13.0</version>
        <configuration>
            <release>21</release>
            <compilerArgs>
                <arg>--enable-preview</arg>  <!-- Java 21 ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ í™œì„±í™” -->
            </compilerArgs>
        </configuration>
    </plugin>
    
    <!-- 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í”ŒëŸ¬ê·¸ì¸ -->
    <plugin>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>3.2.5</version>
        <configuration>
            <argLine>--enable-preview</argLine>  <!-- í…ŒìŠ¤íŠ¸ ì‹œ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ -->
        </configuration>
    </plugin>
    
    <!-- 3. í”„ë¡œê·¸ë¨ ì‹¤í–‰ í”ŒëŸ¬ê·¸ì¸ -->
    <plugin>
        <artifactId>exec-maven-plugin</artifactId>
        <version>3.1.0</version>
        <configuration>
            <mainClass>com.demo.NetworkChatApp</mainClass>
            <arguments>
                <argument>--enable-preview</argument>
                <argument>--enable-native-access=ALL-UNNAMED</argument>
            </arguments>
        </configuration>
    </plugin>
</plugins>
```

**í”ŒëŸ¬ê·¸ì¸ ì—­í• **:

| í”ŒëŸ¬ê·¸ì¸ | ì—­í•  | Maven ëª…ë ¹ì–´ |
|---------|------|-------------|
| `maven-compiler-plugin` | Java ì†ŒìŠ¤ ì»´íŒŒì¼ | `mvn compile` |
| `maven-surefire-plugin` | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ | `mvn test` |
| `exec-maven-plugin` | ë©”ì¸ í´ë˜ìŠ¤ ì‹¤í–‰ | `mvn exec:java` |
| `maven-jar-plugin` | JAR íŒŒì¼ ìƒì„± | `mvn package` |

---

### 10.5 JVM í”Œë˜ê·¸ ì„¤ëª…

í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œ í•„ìš”í•œ JVM í”Œë˜ê·¸ë“¤:

```bash
java --enable-preview \                    # Java 21 ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
     --enable-native-access=ALL-UNNAMED \  # FFI ë„¤ì´í‹°ë¸Œ ì ‘ê·¼ í—ˆìš©
     -Djava.library.path=lib/native \      # ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê²½ë¡œ
     -cp "target/classes:lib/*.jar" \      # í´ë˜ìŠ¤íŒ¨ìŠ¤
     com.demo.NetworkChatApp                   # ë©”ì¸ í´ë˜ìŠ¤
```

| í”Œë˜ê·¸ | ì„¤ëª… |
|--------|------|
| `--enable-preview` | Java 21ì˜ ì‹¤í—˜ì  ê¸°ëŠ¥ ì‚¬ìš© (íŒ¨í„´ ë§¤ì¹­ ë“±) |
| `--enable-native-access=ALL-UNNAMED` | jNetPcapì´ libpcapì— ì ‘ê·¼í•˜ë„ë¡ í—ˆìš© |
| `-Djava.library.path` | ë„¤ì´í‹°ë¸Œ DLL/SO íŒŒì¼ ê²€ìƒ‰ ê²½ë¡œ |

---

### 10.6 í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
last/
â”œâ”€â”€ pom.xml                 # Maven ë¹Œë“œ ì„¤ì •
â”œâ”€â”€ run.sh                  # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (macOS/Linux)
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ jnetpcap-wrapper-2.3.1-jdk21.jar  # jNetPcap ë¼ì´ë¸ŒëŸ¬ë¦¬
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/java/com/demo/  # ì†ŒìŠ¤ ì½”ë“œ
â”‚   â””â”€â”€ test/java/com/demo/  # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”œâ”€â”€ target/                  # ë¹Œë“œ ê²°ê³¼ë¬¼
â”‚   â”œâ”€â”€ classes/            # ì»´íŒŒì¼ëœ .class íŒŒì¼
â”‚   â””â”€â”€ test-classes/       # ì»´íŒŒì¼ëœ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
â”œâ”€â”€ docker-compose.yml      # Docker ì„¤ì •
â”œâ”€â”€ Dockerfile              # Docker ì´ë¯¸ì§€ ë¹Œë“œ
â”œâ”€â”€ README.md               # í”„ë¡œì íŠ¸ ê°œìš”
â”œâ”€â”€ DOCUMENTATION.md        # ìƒì„¸ ë¬¸ì„œ (ì´ íŒŒì¼)
â””â”€â”€ WINDOWS_GUIDE.md        # Windows ì‹¤í–‰ ê°€ì´ë“œ
```

### 10.7 ì‹¤í–‰ ë°©ë²•
    <configuration>
        <release>21</release>
        <compilerArgs>
            <arg>--enable-preview</arg>
        </compilerArgs>
    </configuration>
</plugin>
```

### 10.7 ì‹¤í–‰ ë°©ë²•

**ë¡œì»¬ ì‹¤í–‰**:
```bash
# 1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd last

# 2. ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
sudo ./run.sh

# ë˜ëŠ” Mavenìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰
sudo mvn exec:exec@run-app
```

**Docker ì‹¤í–‰**:
```bash
# ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up --build

# í…ŒìŠ¤íŠ¸ ëª¨ë“œ
docker run --rm -e APP_MODE=test network-chat:latest
```

---

## ğŸ“– ì°¸ê³  ìë£Œ

- [RFC 791 - Internet Protocol](https://tools.ietf.org/html/rfc791)
- [RFC 826 - Address Resolution Protocol](https://tools.ietf.org/html/rfc826)
- [IEEE 802.3 - Ethernet](https://standards.ieee.org/standard/802_3-2018.html)
- [jNetPcap Documentation](https://github.com/slytechs-repos/jnetpcap-wrapper)
- [libpcap ê³µì‹ ì‚¬ì´íŠ¸](https://www.tcpdump.org/)
- [Npcap ê³µì‹ ì‚¬ì´íŠ¸](https://npcap.com/)

---

*ì´ ë¬¸ì„œëŠ” 2024ë…„ 12ì›” ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
